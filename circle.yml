machine:
  python:
    version: 3.5.0
  environment:
    PY_VERSIONS: '2.7.10 3.3.3 3.4.3 3.5.0 pypy-2.5.0'

general:
  artifacts:
    - .tox/tox/junit.xml
    - .tox/tox/flake8.txt
    - .tox/coverage.xml

dependencies:
  override:
    - pip install --upgrade pip
    - pip install --upgrade tox
    - pip install --upgrade coveralls
    - pyenv local $PY_VERSIONS

test:
  override:
    - tox -r
  post:
  - coveralls
  - mkdir -p $CIRCLE_TEST_REPORTS/dankbot
  - cp .tox/tox/junit.xml $CIRCLE_TEST_REPORTS/dankbot
  - cp .tox/tox/flake8.txt $CIRCLE_TEST_REPORTS/dankbot

deployment:
  production:
    branch: master
    commands:
      -  ssh $DEPLOY_HOST $DEPLOY_PATH/deploy.sh
